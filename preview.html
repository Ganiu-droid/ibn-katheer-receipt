<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Grading System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body class="p-4">

    <h2 class="mb-3">Student Grading System</h2>
  <!-- ******ENTER STUDENT DETAILS HERE -->
      <div>
      <label for="student-name" class="form-label">Student name</label>
      <input type="text" class="form-control" id="student-name" placeholder="Enter name" required>
      </div>

      <div class="mb-3">
    <label for="class-select" class="form-label">Select Faslu</label>
    <select class="form-control" id="class-select" required>
        <option value="" disabled selected>Select Faslu</option>
        <option value="Abee Bakr">Faslu Abee Bakr</option>
        <option value="Umar">Faslu Umar</option>
        <option value="Aliyy">Faslu Aliyy</option>
        <option value="Aliyy">Faslu Uthman</option>
        <option value="Rawdah 1">Faslu Rawdah 1</option>
        <option value="Rawdah 2">Faslu Rawdah 2</option>
    </select>
      </div>

      <div class="mb-3">
        <label for="term-select" class="form-label">Select Term</label>
        <select class="form-control" id="term-select" required>
            <option value="" disabled selected>Select a term</option>
            <option value="1st Term">1st Term</option>
            <option value="2nd Term">2nd Term</option>
            <option value="3rd Term">3rd Term</option>
        </select>
    </div>

  <!-- ******ENTER STUDENT DETAILS HERE -->
    <button id="add-subject" class="btn btn-primary mb-3">Add Subject</button>
    <button id="preview-results" class="btn btn-info mb-3">Preview Results</button>

    <table class="table table-bordered border-primary">
        <thead>
            <tr>
                <th>S/N</th>
                <th>Subject</th>
                <th>Score</th>
                <th>Grade</th>
                <th>Remark</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="subject-table-body"></tbody>
    </table>

    <h4 class="mt-4">Final Entries:</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Subject</th>
                <th>Score</th>
                <th>Grade</th>
                <th>Remark</th>
            </tr>
        </thead>
        <tbody id="display-results"></tbody>
    </table>

    <h4 class="mt-4">Summary:</h4>
    <p><strong>Total Score:</strong> <span id="total-score">0</span></p>
    <p><strong>Average Score:</strong> <span id="average-score">0</span></p>

    <!-- Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Preview Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- *************RESULT CONTENT TO DISPLAY  -->
                <div class="modal-body" id="modal-body">
                  <!-- SCHOOL DETAILS GOES HERE -->
                  <div class="container">
                    <div class="row align-items-center letterhead">
                        <!-- Logo Section (Left) -->
                        <div class="col-md-3">
                            <img src="./img/ibn-katheer-logo.png" alt="Company Logo" class="img-fluid logo mx-auto">
                        </div>

                        <!-- Text Section (Right) -->
                        <div class="col-md-9 text-end">
                            <h4 class= " school-name">مدرسة ابن كثير لتحفيظ القرآن و الدراسة الإسلامية</h4>
                            <h5 id="company-name" class="font-weight-bold">Ibn Katheer school of Memorization of Qur'an and Islamic studies</h5>
                            <p id="head-office" class="fst-italic">Head Office: Ogaga Str., Aka Layout, Off Refinery road, Warri, Delta State</p>
                            <p class="mb-0">Email: ibnkatheertahfeedhschool@gmail.com | Phone: +234 706 314 2465, +234 803 303 4627</p>
                        </div>
                        <h2 class="my-2 text-center text-danger">Student Report</h2>
                    </div>
                </div>
                   <!--STUDENT DETALS-->
                  <!-- <div>student info goes here</div> -->
                  <div id="displayName"></div>
                    <div id="displayTerm"></div>
                    <div id="displayClass"></div>
                  <!--STUDENT DETAILS-->
                    <table class="table table-bordered border-primary">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Score</th>
                                <th>Grade</th>
                                <th>Remark</th>
                            </tr>
                        </thead>
                        <tbody id="preview-results-body"></tbody>
                    </table>
                    <p><strong>Total Score:</strong> <span id="preview-total-score">0</span></p>
                    <p><strong>Average Score:</strong> <span id="preview-average-score">0</span></p>
                    <div>
                      <div>
                        <!-- GRADE SYSTEM TABLE START-->
                        <table class=" w-50 table table-striped table-bordered m-5 caption-top ">
                            <caption>Grading system</caption>
                            <thead class="grade-system">
                              <tr>
                                <th scope="col">#</th>
                                <th scope="col">score</th>
                                <th scope="col">grade</th>
                                <th scope="col">remark</th>
                              </tr>
                            </thead>
                            <tbody class="grade-system">
                              <tr>
                                <th scope="row">1</th>
                                <td>70-100</td>
                                <td>A</td>
                                <td>Excellent</td>
                              </tr>
                              <tr>
                                <th scope="row">2</th>
                                <td>60-69</td>
                                <td>B</td>
                                <td>Good</td>
                              </tr>
                              <tr>
                                <th scope="row">3</th>
                                <td >50-59</td>
                                <td>C</td>
                                <td>Satisfactory</td>
                              </tr>
                              <tr>
                                <th scope="row">4</th>
                                <td >40-49</td>
                                <td>D</td>
                                <td>Below average</td>
                              </tr>
                              <tr>
                                <th scope="row">4</th>
                                <td >30-39</td>
                                <td>E</td>
                                <td>Needs improvement</td>
                              </tr>
                              <tr>
                                <th scope="row">5</th>
                                <td >0-29</td>
                                <td>F</td>
                                <td>Fail</td>
                              </tr>
                            </tbody>
                          </table>
                          <!-- GRADE SYSTEM TABLE ENDS -->
                      </div>
                    </div>
                </div>
                 <!-- *************RESULT CONTENT TO DISPLAY  ENDS-->
                <div class="modal-footer">
                  <div class="modal-footer">
                    <button id="download-jpeg" class="btn btn-success">Download as JPEG</button>
                    <button id="download-pdf" class="btn btn-primary">Download as PDF</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <script>
        let subjectCount = 0;
        let totalScore = 0;
        let scores = [];
        let savedEntries = [];

        const subjects = ["Adhkar","Arabic", "Aqeedah", "Hadith", "Handwriting", "Huruf", "Tahfeedh", "Tajweed", "Tawheed"];

        document.getElementById("add-subject").addEventListener("click", function() {
            const tableBody = document.getElementById("subject-table-body");
            subjectCount++;

            const newRow = document.createElement("tr");
            newRow.innerHTML = `
                <td>${subjectCount}</td>
                <td>
                    <select class="form-control subject-select">
                        <option value="">Select Subject</option>
                        ${subjects.map(subj => `<option value="${subj}">${subj}</option>`).join('')}
                    </select>
                </td>
                <td><input type="number" class="form-control score-input" placeholder="Enter score"></td>
                <td class="grade"></td>
                <td class="remark"></td>
                <td>
                    <button class="btn btn-success btn-save">Save</button>
                    <button class="btn btn-danger btn-delete">Delete</button>
                </td>
            `;
            tableBody.appendChild(newRow);

            newRow.querySelector(".btn-save").addEventListener("click", function() {
                const subject = newRow.querySelector(".subject-select").value.trim();
                const score = parseInt(newRow.querySelector(".score-input").value.trim());

                if (subject && !isNaN(score)) {
                    const { grade, remark } = getGradeAndRemark(score);
                    return saveEntry(subject, score, grade, remark, newRow);
                } else {
                    alert("Please select a subject and enter a valid score.");
                }
            });

            newRow.querySelector(".btn-delete").addEventListener("click", function() {
                newRow.remove();
            });
        });

        function getGradeAndRemark(score) {
            if (score >= 70) return { grade: "A", remark: "Excellent" };
            if (score >= 60) return { grade: "B", remark: "Good" };
            if (score >= 50) return { grade: "C", remark: "Satisfactory" };
            if (score >= 40) return { grade: "D", remark: "Below Average" };
            if (score >= 30) return { grade: "E", remark: "Needs Improvement" };
            return { grade: "F", remark: "Fail" };
        }

        function saveEntry(subject, score, grade, remark, row) {
            document.getElementById("display-results").innerHTML += `
                <tr>
                    <td>${subject}</td>
                    <td>${score}</td>
                    <td>${grade}</td>
                    <td>${remark}</td>
                </tr>
            `;

            scores.push(score);
            totalScore += score;
            updateSummary();

            const newEntry = { subject, score, grade, remark, totalScore, averageScore: calculateAverage() };
            savedEntries.push(newEntry);

            row.remove();
            return newEntry;
        }

        function updateSummary() {
            document.getElementById("total-score").textContent = totalScore;
            document.getElementById("average-score").textContent = calculateAverage();
        }

        function calculateAverage() {
            return scores.length > 0 ? (totalScore / scores.length).toFixed(2) : 0;
        }

        // Preview Results
        document.getElementById("preview-results").addEventListener("click", function() {
            const previewBody = document.getElementById("preview-results-body");
            previewBody.innerHTML = "";
            savedEntries.forEach(entry => {
                previewBody.innerHTML += `
                    <tr>
                        <td>${entry.subject}</td>
                        <td>${entry.score}</td>
                        <td>${entry.grade}</td>
                        <td>${entry.remark}</td>
                    </tr>
                `;
            });

            document.getElementById("preview-total-score").textContent = totalScore;
            document.getElementById("preview-average-score").textContent = calculateAverage();

            // ----add student info-----
            document.getElementById("student-name").addEventListener("input", function() {
            let studentName = this.value;
            document.getElementById("displayName").innerHTML = `<p><strong class="font-weight-bold">NAME:</strong> ${studentName || "No term entered"}</p>`;
                console.log(studentName)
        });

            document.getElementById("term-select").addEventListener("change", function() {
            let selectedTerm = this.value;
            document.getElementById("displayTerm").innerHTML = `<strong>TERM:</strong> ${selectedTerm || "No term selected"}`;
            console.log(selectedTerm)
        });
            document.getElementById("class-select").addEventListener("change", function() {
            let selectedClass = this.value;
            document.getElementById("displayClass").innerHTML = `<strong>FASLU:</strong> ${selectedClass || "No Class selected"}`;
        });

        //-----add student info ends here----

            const previewModal = new bootstrap.Modal(document.getElementById("previewModal"));
            previewModal.show();
        });

        document.getElementById("download-jpeg").addEventListener("click", function () {
      const previewModalBody = document.querySelector(".modal-body");

      html2canvas(previewModalBody).then(canvas => {
          const link = document.createElement("a");
          link.href = canvas.toDataURL("image/jpeg");
          link.download = "preview_result.jpeg";
          link.click();
      });
  });

  document.getElementById("download-pdf").addEventListener("click", function () {
      const previewModalBody = document.querySelector(".modal-body");

      html2canvas(previewModalBody).then(canvas => {
          const imgData = canvas.toDataURL("image/png");
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF("p", "mm", "a4");

          const imgWidth = 190; // A4 width in mm
          const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio

          pdf.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
          pdf.save("preview_result.pdf");
      });
  });
    </script>

</body>
</html>
